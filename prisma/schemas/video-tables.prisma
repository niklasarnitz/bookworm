model Movie {
  id                  String         @id @default(cuid())
  title               String
  originalReleaseYear Int
  plot                String?
  posterUrl           String?
  tmdbId              String?        @unique
  imdbId              String?        @unique
  watchedAt           DateTime?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  categoryId          String?
  userId              String
  releases            MediaRelease[]
  category            Category?      @relation(fields: [categoryId], references: [id])
  user                User           @relation(fields: [userId], references: [id])

  @@index([title])
  @@index([categoryId])
  @@index([watchedAt])
}

model TvShow {
  id                  String               @id @default(cuid())
  title               String
  originalReleaseYear Int
  plot                String?
  posterUrl           String?
  tmdbId              String?              @unique
  imdbId              String?              @unique
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  categoryId          String?
  userId              String
  seasons             TvSeason[]
  category            Category?            @relation(fields: [categoryId], references: [id])
  user                User                 @relation(fields: [userId], references: [id])

  @@index([title])
  @@index([categoryId])
}

model TvSeason {
  id                  String               @id @default(cuid())
  tvShowId            String
  seasonNumber        Int
  title               String?
  releaseYear         Int?
  episodeCount        Int?
  plot                String?
  posterUrl           String?
  watchedAt           DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  userId              String
  releases            TvSeasonRelease[]
  tvShow              TvShow               @relation(fields: [tvShowId], references: [id], onDelete: Cascade)
  user                User                 @relation(fields: [userId], references: [id])

  @@unique([tvShowId, seasonNumber])
  @@index([tvShowId])
  @@index([watchedAt])
}

model TvSeasonRelease {
  id               String         @id @default(cuid())
  tvSeasonId       String
  editionName      String?
  releaseDate      DateTime?
  countryOfRelease String?
  upc              String?        @unique
  publisherNumber  String?
  asin             String?        @unique
  userId           String
  distributor      String?
  publisher        String?
  tvSeason         TvSeason       @relation(fields: [tvSeasonId], references: [id], onDelete: Cascade)
  user             User           @relation(fields: [userId], references: [id])
  items            PhysicalItem[]

  @@index([tvSeasonId])
}

model MediaRelease {
  id               String         @id @default(cuid())
  movieId          String
  editionName      String?
  releaseDate      DateTime?
  countryOfRelease String?
  upc              String?        @unique
  publisherNumber  String?
  asin             String?        @unique
  userId           String
  distributor      String?
  publisher        String?
  movie            Movie          @relation(fields: [movieId], references: [id], onDelete: Cascade)
  user             User           @relation(fields: [userId], references: [id])
  items            PhysicalItem[]

  @@index([movieId])
}

model PhysicalItem {
  id                String            @id @default(cuid())
  mediaReleaseId    String?
  tvSeasonReleaseId String?
  format            VideoFormat
  discName          String?
  discNumber        Int?
  aspectRatio       String?
  durationMinutes   Int?
  audioTracks       AudioTrack[]
  mediaRelease      MediaRelease?     @relation(fields: [mediaReleaseId], references: [id], onDelete: Cascade)
  tvSeasonRelease   TvSeasonRelease?  @relation(fields: [tvSeasonReleaseId], references: [id], onDelete: Cascade)
  subtitles         Subtitle[]

  @@index([mediaReleaseId])
  @@index([tvSeasonReleaseId])
}

model AudioTrack {
  id             String       @id @default(cuid())
  physicalItemId String
  language       String
  codec          String
  channels       String
  physicalItem   PhysicalItem @relation(fields: [physicalItemId], references: [id], onDelete: Cascade)

  @@index([physicalItemId])
}

model Subtitle {
  id             String       @id @default(cuid())
  physicalItemId String
  language       String
  physicalItem   PhysicalItem @relation(fields: [physicalItemId], references: [id], onDelete: Cascade)

  @@index([physicalItemId])
}
